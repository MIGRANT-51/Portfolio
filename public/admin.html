<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NK Admin — Contact Messages</title>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    :root {
      --bg:     #060a10; --s1: #0a1018; --s2: #0f1824; --s3: #141f30;
      --blue:   #3d8ef0; --cyan: #22d3ee; --green: #22c55e;
      --red:    #ef4444; --yellow: #eab308; --orange: #f97316;
      --border: rgba(61,142,240,0.15); --border2: rgba(61,142,240,0.28);
      --white:  #e2eaf8; --muted: #5a7090; --muted2: #8a9ab8;
      --mono:   'JetBrains Mono', monospace; --display: 'Syne', sans-serif;
      --glow:   rgba(61,142,240,0.25);
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { background: var(--bg); color: var(--white); font-family: var(--mono); font-size: 13px; min-height: 100vh; }
    body::before {
      content:''; position:fixed; inset:0; z-index:0; pointer-events:none;
      background-image: linear-gradient(rgba(61,142,240,.03) 1px,transparent 1px), linear-gradient(90deg,rgba(61,142,240,.03) 1px,transparent 1px);
      background-size: 48px 48px;
    }

    /* ── LAYOUT ── */
    .shell { display:grid; grid-template-columns:240px 1fr; min-height:100vh; position:relative; z-index:1; }

    /* ── SIDEBAR ── */
    aside {
      background: var(--s1); border-right: 1px solid var(--border);
      padding: 24px 0; display:flex; flex-direction:column;
      position:sticky; top:0; height:100vh; overflow-y:auto;
    }
    .sidebar-logo { padding: 0 20px 24px; border-bottom: 1px solid var(--border); }
    .sidebar-logo .logo { font-family:var(--display); font-size:18px; font-weight:800; color:var(--blue); }
    .sidebar-logo .sub  { font-size:10px; color:var(--muted); letter-spacing:.1em; text-transform:uppercase; margin-top:4px; }
    .sidebar-nav { padding: 16px 12px; flex:1; }
    .nav-item {
      display:flex; align-items:center; gap:10px;
      padding:10px 12px; border-radius:6px; cursor:pointer;
      font-size:12px; color:var(--muted); letter-spacing:.05em;
      transition:all .2s; text-decoration:none; margin-bottom:2px;
    }
    .nav-item i { width:16px; text-align:center; font-size:13px; }
    .nav-item:hover { background:var(--s2); color:var(--white); }
    .nav-item.active { background:rgba(61,142,240,.12); color:var(--blue); border:1px solid var(--border2); }
    .nav-badge {
      margin-left:auto; background:var(--red); color:#fff;
      font-size:9px; padding:2px 6px; border-radius:10px; font-weight:600;
    }
    .sidebar-footer { padding:16px 20px; border-top:1px solid var(--border); }
    .auth-form { display:flex; flex-direction:column; gap:8px; }
    .auth-input {
      background:var(--s2); border:1px solid var(--border); border-radius:4px;
      padding:8px 10px; color:var(--white); font-family:var(--mono); font-size:11px;
      outline:none; width:100%;
    }
    .auth-input:focus { border-color:var(--blue); }
    .auth-btn {
      background:var(--blue); border:none; border-radius:4px;
      padding:8px; color:#fff; font-family:var(--mono); font-size:10px;
      letter-spacing:.08em; text-transform:uppercase; cursor:pointer;
      transition:all .2s;
    }
    .auth-btn:hover { opacity:.85; }
    #auth-status { font-size:10px; color:var(--muted); text-align:center; }

    /* ── MAIN ── */
    main { padding: 32px; overflow-y:auto; }
    .page-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:32px; }
    .page-title { font-family:var(--display); font-size:24px; font-weight:800; }
    .page-title span { color:var(--blue); }

    /* ── STATS ROW ── */
    .stats-row { display:grid; grid-template-columns:repeat(5,1fr); gap:12px; margin-bottom:32px; }
    .stat-card {
      background:var(--s1); border:1px solid var(--border); border-radius:8px;
      padding:20px 16px; text-align:center; transition:border-color .2s;
    }
    .stat-card:hover { border-color:var(--blue); }
    .stat-num { font-family:var(--display); font-size:2rem; font-weight:800; line-height:1; margin-bottom:6px; }
    .stat-lbl { font-size:9px; color:var(--muted); letter-spacing:.1em; text-transform:uppercase; }
    .num-blue   { color:var(--blue); }
    .num-red    { color:var(--red); }
    .num-green  { color:var(--green); }
    .num-yellow { color:var(--yellow); }
    .num-muted  { color:var(--muted2); }

    /* ── TOOLBAR ── */
    .toolbar {
      display:flex; align-items:center; gap:10px; margin-bottom:16px; flex-wrap:wrap;
    }
    .filter-btn {
      background:none; border:1px solid var(--border); border-radius:20px;
      padding:6px 14px; font-family:var(--mono); font-size:10px;
      color:var(--muted); letter-spacing:.06em; cursor:pointer; transition:all .2s;
      text-transform:uppercase;
    }
    .filter-btn:hover { border-color:var(--blue); color:var(--white); }
    .filter-btn.active { background:rgba(61,142,240,.12); border-color:var(--blue); color:var(--blue); }
    .spacer { flex:1; }
    .export-btn {
      background:none; border:1px solid var(--border); border-radius:4px;
      padding:7px 14px; font-family:var(--mono); font-size:10px; color:var(--muted);
      letter-spacing:.08em; cursor:pointer; transition:all .2s; text-transform:uppercase;
      display:flex; align-items:center; gap:7px;
    }
    .export-btn:hover { border-color:var(--green); color:var(--green); }

    /* ── TABLE ── */
    .table-wrap { background:var(--s1); border:1px solid var(--border); border-radius:8px; overflow:hidden; }
    table { width:100%; border-collapse:collapse; }
    thead th {
      background:var(--s2); padding:12px 16px; text-align:left;
      font-size:9px; color:var(--muted); letter-spacing:.12em; text-transform:uppercase;
      border-bottom:1px solid var(--border); font-weight:400;
    }
    tbody tr { border-bottom:1px solid var(--border); transition:background .15s; cursor:pointer; }
    tbody tr:last-child { border-bottom:none; }
    tbody tr:hover { background:var(--s2); }
    tbody tr.selected { background:rgba(61,142,240,.07); }
    td { padding:14px 16px; font-size:12px; vertical-align:top; }
    td.id-col   { color:var(--muted); font-size:11px; width:50px; }
    td.name-col { color:var(--white); font-weight:500; }
    td.email-col{ color:var(--blue); }
    td.preview-col { color:var(--muted2); max-width:280px; line-height:1.6; }
    td.date-col { color:var(--muted); font-size:11px; white-space:nowrap; }
    .status-badge {
      font-size:9px; padding:3px 8px; border-radius:20px;
      letter-spacing:.08em; text-transform:uppercase; white-space:nowrap;
    }
    .status-new      { background:rgba(239,68,68,.12);  color:var(--red);    border:1px solid rgba(239,68,68,.3); }
    .status-read     { background:rgba(34,197,94,.1);   color:var(--green);  border:1px solid rgba(34,197,94,.25); }
    .status-archived { background:rgba(90,112,144,.1);  color:var(--muted);  border:1px solid var(--border); }

    /* ── MESSAGE DRAWER ── */
    .drawer-overlay {
      display:none; position:fixed; inset:0; background:rgba(6,10,16,.7);
      backdrop-filter:blur(6px); z-index:200;
    }
    .drawer-overlay.open { display:block; }
    .drawer {
      position:fixed; right:0; top:0; bottom:0; width:520px;
      background:var(--s1); border-left:1px solid var(--border);
      display:flex; flex-direction:column; z-index:201;
      transform:translateX(100%); transition:transform .3s cubic-bezier(.25,1,.5,1);
    }
    .drawer.open { transform:translateX(0); }
    .drawer-header {
      padding:20px 24px; border-bottom:1px solid var(--border);
      display:flex; align-items:center; justify-content:space-between;
    }
    .drawer-close {
      background:none; border:1px solid var(--border); border-radius:4px;
      width:32px; height:32px; color:var(--muted); cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      transition:all .2s; font-size:13px;
    }
    .drawer-close:hover { border-color:var(--red); color:var(--red); }
    .drawer-body { padding:24px; overflow-y:auto; flex:1; }
    .drawer-meta { display:flex; flex-direction:column; gap:10px; margin-bottom:20px; }
    .meta-row { display:flex; gap:12px; }
    .meta-key  { font-size:10px; color:var(--muted); letter-spacing:.08em; text-transform:uppercase; width:60px; flex-shrink:0; padding-top:2px; }
    .meta-val  { font-size:13px; color:var(--white); }
    .meta-val a { color:var(--blue); text-decoration:none; }
    .msg-body {
      background:var(--s2); border:1px solid var(--border); border-left:3px solid var(--blue);
      border-radius:4px; padding:16px; font-size:13px; color:var(--muted2);
      line-height:1.8; white-space:pre-wrap; word-break:break-word;
      margin-top:16px;
    }
    .drawer-actions { padding:16px 24px; border-top:1px solid var(--border); display:flex; gap:8px; }
    .action-btn {
      flex:1; background:none; border:1px solid var(--border); border-radius:4px;
      padding:10px; font-family:var(--mono); font-size:10px; color:var(--muted);
      letter-spacing:.08em; text-transform:uppercase; cursor:pointer; transition:all .2s;
      display:flex; align-items:center; justify-content:center; gap:6px;
    }
    .action-btn:hover { color:var(--white); border-color:var(--white); }
    .action-btn.danger:hover { color:var(--red); border-color:var(--red); }
    .action-btn.success:hover { color:var(--green); border-color:var(--green); }

    /* ── PAGINATION ── */
    .pagination { display:flex; align-items:center; justify-content:center; gap:8px; margin-top:20px; }
    .page-btn {
      background:var(--s1); border:1px solid var(--border); border-radius:4px;
      padding:7px 12px; font-family:var(--mono); font-size:11px; color:var(--muted);
      cursor:pointer; transition:all .2s;
    }
    .page-btn:hover { border-color:var(--blue); color:var(--blue); }
    .page-btn.active { background:rgba(61,142,240,.12); border-color:var(--blue); color:var(--blue); }
    .page-btn:disabled { opacity:.3; cursor:not-allowed; }
    .page-info { font-size:11px; color:var(--muted); padding:0 8px; }

    /* ── EMPTY STATE ── */
    .empty {
      text-align:center; padding:60px 20px; color:var(--muted);
    }
    .empty i { font-size:40px; margin-bottom:16px; opacity:.3; }
    .empty p { font-size:13px; }

    /* ── TOAST ── */
    #toast {
      position:fixed; bottom:24px; right:24px; z-index:300;
      background:var(--s2); border:1px solid var(--border); border-radius:6px;
      padding:12px 20px; font-size:12px; color:var(--white);
      box-shadow:0 8px 24px rgba(0,0,0,.4);
      transform:translateY(20px); opacity:0;
      transition:all .3s; pointer-events:none;
    }
    #toast.show { transform:translateY(0); opacity:1; }
    #toast.success { border-color:rgba(34,197,94,.4); }
    #toast.error   { border-color:rgba(239,68,68,.4); }

    @media(max-width:900px) { .shell { grid-template-columns:1fr; } aside { display:none; } .stats-row { grid-template-columns:repeat(2,1fr); } .drawer { width:100%; } }
  </style>
</head>
<body>
<div class="shell">

  <!-- SIDEBAR -->
  <aside>
    <div class="sidebar-logo">
      <div class="logo">NK//ADMIN</div>
      <div class="sub">Portfolio Dashboard</div>
    </div>
    <nav class="sidebar-nav">
      <a class="nav-item active" href="/admin">
        <i class="fas fa-inbox"></i> Inbox
        <span class="nav-badge" id="unread-badge" style="display:none">0</span>
      </a>
      <a class="nav-item" href="/">
        <i class="fas fa-globe"></i> Portfolio
      </a>
      <a class="nav-item" href="/threat-toolkit.html">
        <i class="fas fa-crosshairs"></i> Toolkit
      </a>
      <a class="nav-item" href="/api/health" target="_blank">
        <i class="fas fa-server"></i> API Health
      </a>
    </nav>
    <div class="sidebar-footer">
      <div class="auth-form">
        <div style="font-size:10px;color:var(--muted);letter-spacing:.08em;text-transform:uppercase;margin-bottom:4px;"><i class="fas fa-key" style="margin-right:6px;color:var(--blue)"></i>Admin Token</div>
        <input class="auth-input" type="password" id="token-input" placeholder="Enter ADMIN_TOKEN"/>
        <button class="auth-btn" onclick="saveToken()">Authenticate</button>
        <div id="auth-status">No token set — open access</div>
      </div>
    </div>
  </aside>

  <!-- MAIN -->
  <main>
    <div class="page-header">
      <div class="page-title">Contact <span>Inbox</span></div>
      <div style="font-size:11px;color:var(--muted)" id="last-updated"></div>
    </div>

    <!-- STATS -->
    <div class="stats-row" id="stats-row">
      <div class="stat-card"><div class="stat-num num-blue" id="s-total">—</div><div class="stat-lbl">Total</div></div>
      <div class="stat-card"><div class="stat-num num-red"  id="s-unread">—</div><div class="stat-lbl">Unread</div></div>
      <div class="stat-card"><div class="stat-num num-green" id="s-read">—</div><div class="stat-lbl">Read</div></div>
      <div class="stat-card"><div class="stat-num num-muted" id="s-archived">—</div><div class="stat-lbl">Archived</div></div>
      <div class="stat-card"><div class="stat-num num-yellow" id="s-senders">—</div><div class="stat-lbl">Unique Senders</div></div>
    </div>

    <!-- TOOLBAR -->
    <div class="toolbar">
      <button class="filter-btn active" onclick="setFilter('all',this)">All</button>
      <button class="filter-btn" onclick="setFilter('new',this)">New</button>
      <button class="filter-btn" onclick="setFilter('read',this)">Read</button>
      <button class="filter-btn" onclick="setFilter('archived',this)">Archived</button>
      <div class="spacer"></div>
      <button class="export-btn" onclick="exportCSV()"><i class="fas fa-download"></i> Export CSV</button>
      <button class="export-btn" onclick="loadContacts()" style="border-color:var(--blue);color:var(--blue)"><i class="fas fa-rotate"></i> Refresh</button>
    </div>

    <!-- TABLE -->
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Email</th>
            <th>Preview</th>
            <th>Status</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody id="contacts-tbody">
          <tr><td colspan="6"><div class="empty"><i class="fas fa-inbox"></i><p>Loading messages...</p></div></td></tr>
        </tbody>
      </table>
    </div>

    <!-- PAGINATION -->
    <div class="pagination" id="pagination"></div>
  </main>
</div>

<!-- MESSAGE DRAWER -->
<div class="drawer-overlay" id="drawer-overlay" onclick="closeDrawer()"></div>
<div class="drawer" id="drawer">
  <div class="drawer-header">
    <div>
      <div style="font-family:var(--display);font-size:16px;font-weight:700" id="drawer-title">Message</div>
      <div style="font-size:10px;color:var(--muted);margin-top:4px" id="drawer-date"></div>
    </div>
    <button class="drawer-close" onclick="closeDrawer()"><i class="fas fa-xmark"></i></button>
  </div>
  <div class="drawer-body">
    <div class="drawer-meta" id="drawer-meta"></div>
    <div class="msg-body" id="drawer-message"></div>
  </div>
  <div class="drawer-actions">
    <button class="action-btn success" id="btn-mark-new"      onclick="updateStatus('new')"><i class="fas fa-envelope"></i> Mark New</button>
    <button class="action-btn"         id="btn-mark-archived" onclick="updateStatus('archived')"><i class="fas fa-archive"></i> Archive</button>
    <button class="action-btn danger"  id="btn-delete"        onclick="deleteContact()"><i class="fas fa-trash"></i> Delete</button>
  </div>
</div>

<!-- TOAST -->
<div id="toast"></div>

<script>
// ─── STATE ────────────────────────────────────────────────────────
let token        = localStorage.getItem('admin_token') || '';
let currentPage  = 1;
let currentFilter= 'all';
let currentId    = null;
let totalPages   = 1;

// ─── AUTH ─────────────────────────────────────────────────────────
function saveToken() {
  token = document.getElementById('token-input').value.trim();
  localStorage.setItem('admin_token', token);
  document.getElementById('auth-status').textContent = token ? '✓ Token saved' : 'No token — open access';
  document.getElementById('auth-status').style.color = token ? 'var(--green)' : 'var(--muted)';
  loadAll();
}

function headers() {
  const h = { 'Content-Type': 'application/json' };
  if (token) h['x-admin-token'] = token;
  return h;
}

// ─── LOAD ─────────────────────────────────────────────────────────
async function loadAll() {
  loadStats();
  loadContacts();
}

async function loadStats() {
  try {
    const res  = await fetch('/api/contact/stats', { headers: headers() });
    const data = await res.json();
    document.getElementById('s-total').textContent    = data.total    || 0;
    document.getElementById('s-unread').textContent   = data.unread   || 0;
    document.getElementById('s-read').textContent     = data.read_count || 0;
    document.getElementById('s-archived').textContent = data.archived || 0;
    document.getElementById('s-senders').textContent  = data.unique_senders || 0;
    const badge = document.getElementById('unread-badge');
    badge.textContent = data.unread || 0;
    badge.style.display = data.unread > 0 ? 'inline' : 'none';
  } catch(e) { console.error('Stats error', e); }
}

async function loadContacts() {
  const tbody = document.getElementById('contacts-tbody');
  tbody.innerHTML = `<tr><td colspan="6"><div class="empty"><i class="fas fa-spinner fa-spin"></i><p>Loading...</p></div></td></tr>`;

  try {
    const status = currentFilter !== 'all' ? `&status=${currentFilter}` : '';
    const res  = await fetch(`/api/admin/contacts?page=${currentPage}&limit=15${status}`, { headers: headers() });
    if (res.status === 401) { tbody.innerHTML = `<tr><td colspan="6"><div class="empty"><i class="fas fa-lock"></i><p>Unauthorised. Enter your ADMIN_TOKEN in the sidebar.</p></div></td></tr>`; return; }
    const data = await res.json();
    totalPages = data.totalPages || 1;
    document.getElementById('last-updated').textContent = 'Updated ' + new Date().toLocaleTimeString();

    if (!data.data?.length) {
      tbody.innerHTML = `<tr><td colspan="6"><div class="empty"><i class="fas fa-inbox"></i><p>No messages found.</p></div></td></tr>`;
      renderPagination();
      return;
    }

    tbody.innerHTML = data.data.map(c => `
      <tr onclick="openContact(${c.id})" data-id="${c.id}">
        <td class="id-col">#${c.id}</td>
        <td class="name-col" style="${c.status==='new'?'color:var(--white);font-weight:600':''}">${esc(c.name)}</td>
        <td class="email-col">${esc(c.email)}</td>
        <td class="preview-col">${esc(c.preview)}${c.preview?.length>=120?'…':''}</td>
        <td><span class="status-badge status-${c.status}">${c.status}</span></td>
        <td class="date-col">${c.created}</td>
      </tr>`).join('');

    renderPagination();
  } catch(e) {
    tbody.innerHTML = `<tr><td colspan="6"><div class="empty"><i class="fas fa-triangle-exclamation"></i><p>${e.message}</p></div></td></tr>`;
  }
}

// ─── CONTACT DRAWER ───────────────────────────────────────────────
async function openContact(id) {
  currentId = id;
  document.getElementById('drawer-message').textContent = 'Loading...';
  document.getElementById('drawer-meta').innerHTML = '';
  document.getElementById('drawer-title').textContent = 'Loading...';
  openDrawer();

  try {
    const res  = await fetch(`/api/admin/contacts/${id}`, { headers: headers() });
    const data = await res.json();

    document.getElementById('drawer-title').textContent = data.name;
    document.getElementById('drawer-date').textContent  = data.created;
    document.getElementById('drawer-meta').innerHTML = `
      <div class="meta-row"><div class="meta-key">From</div><div class="meta-val">${esc(data.name)}</div></div>
      <div class="meta-row"><div class="meta-key">Email</div><div class="meta-val"><a href="mailto:${esc(data.email)}">${esc(data.email)}</a></div></div>
      <div class="meta-row"><div class="meta-key">Status</div><div class="meta-val"><span class="status-badge status-${data.status}">${data.status}</span></div></div>
      <div class="meta-row"><div class="meta-key">ID</div><div class="meta-val" style="color:var(--muted)">#${data.id}</div></div>`;
    document.getElementById('drawer-message').textContent = data.message;

    // Refresh row in table
    const row = document.querySelector(`tr[data-id="${id}"]`);
    if (row) {
      const badge = row.querySelector('.status-badge');
      if (badge) { badge.className = `status-badge status-${data.status}`; badge.textContent = data.status; }
      row.querySelector('.name-col').style.fontWeight = data.status === 'new' ? '600' : '400';
    }
    loadStats();
  } catch(e) {
    document.getElementById('drawer-message').textContent = 'Error: ' + e.message;
  }
}

function openDrawer() {
  document.getElementById('drawer').classList.add('open');
  document.getElementById('drawer-overlay').classList.add('open');
}
function closeDrawer() {
  document.getElementById('drawer').classList.remove('open');
  document.getElementById('drawer-overlay').classList.remove('open');
}

// ─── ACTIONS ─────────────────────────────────────────────────────
async function updateStatus(status) {
  if (!currentId) return;
  try {
    const res = await fetch(`/api/admin/contacts/${currentId}`, {
      method: 'PATCH', headers: headers(),
      body: JSON.stringify({ status })
    });
    const data = await res.json();
    if (data.success) {
      toast(`Marked as ${status}`, 'success');
      const meta = document.getElementById('drawer-meta');
      const badge = meta.querySelector('.status-badge');
      if (badge) { badge.className = `status-badge status-${status}`; badge.textContent = status; }
      loadStats();
      loadContacts();
    }
  } catch(e) { toast(e.message, 'error'); }
}

async function deleteContact() {
  if (!currentId || !confirm(`Delete message #${currentId}? This cannot be undone.`)) return;
  try {
    const res = await fetch(`/api/admin/contacts/${currentId}`, {
      method: 'DELETE', headers: headers()
    });
    const data = await res.json();
    if (data.success) {
      toast('Message deleted', 'success');
      closeDrawer();
      loadAll();
    }
  } catch(e) { toast(e.message, 'error'); }
}

function exportCSV() {
  const url = token
    ? `/api/admin/contacts/export/csv?token=${encodeURIComponent(token)}`
    : '/api/admin/contacts/export/csv';
  window.open(url, '_blank');
}

// ─── FILTER & PAGINATION ─────────────────────────────────────────
function setFilter(filter, btn) {
  currentFilter = filter;
  currentPage   = 1;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  loadContacts();
}

function renderPagination() {
  const el = document.getElementById('pagination');
  if (totalPages <= 1) { el.innerHTML = ''; return; }
  let html = `<button class="page-btn" onclick="goPage(${currentPage-1})" ${currentPage===1?'disabled':''}>‹ Prev</button>`;
  for (let i = 1; i <= totalPages; i++) {
    if (i === 1 || i === totalPages || Math.abs(i - currentPage) <= 1) {
      html += `<button class="page-btn ${i===currentPage?'active':''}" onclick="goPage(${i})">${i}</button>`;
    } else if (Math.abs(i - currentPage) === 2) {
      html += `<span class="page-info">…</span>`;
    }
  }
  html += `<button class="page-btn" onclick="goPage(${currentPage+1})" ${currentPage===totalPages?'disabled':''}>Next ›</button>`;
  el.innerHTML = html;
}

function goPage(p) {
  if (p < 1 || p > totalPages) return;
  currentPage = p;
  loadContacts();
}

// ─── HELPERS ─────────────────────────────────────────────────────
function esc(str) {
  return String(str||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

let toastTimer;
function toast(msg, type = '') {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.className = `show ${type}`;
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => el.className = '', 3000);
}

// ─── INIT ─────────────────────────────────────────────────────────
document.addEventListener('DOMContentLoaded', () => {
  if (token) {
    document.getElementById('token-input').value = token;
    document.getElementById('auth-status').textContent = '✓ Token loaded';
    document.getElementById('auth-status').style.color = 'var(--green)';
  }
  loadAll();
  // Auto-refresh every 60 seconds
  setInterval(loadAll, 60000);
});
</script>
</body>
</html>
