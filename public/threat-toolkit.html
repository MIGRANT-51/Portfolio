<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NK//OSINT — Threat Intelligence Toolkit</title>
  <meta name="description" content="Live threat intelligence toolkit by Nehal Kalbande — IOC lookup, URL scanning, certificate intel, and CVE monitoring."/>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=JetBrains+Mono:wght@300;400;500;600&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    :root {
      --bg:       #060a10;
      --s1:       #0a1018;
      --s2:       #0f1824;
      --s3:       #141f30;
      --blue:     #3d8ef0;
      --cyan:     #22d3ee;
      --green:    #22c55e;
      --red:      #ef4444;
      --yellow:   #eab308;
      --orange:   #f97316;
      --border:   rgba(61,142,240,0.15);
      --border2:  rgba(61,142,240,0.28);
      --white:    #e2eaf8;
      --muted:    #5a7090;
      --muted2:   #8a9ab8;
      --mono:     'JetBrains Mono', monospace;
      --display:  'Syne', sans-serif;
      --glow:     rgba(61,142,240,0.3);
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body {
      background: var(--bg);
      color: var(--white);
      font-family: var(--mono);
      font-size: 13px;
      line-height: 1.6;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Grid bg */
    body::before {
      content: '';
      position: fixed; inset: 0; z-index: 0; pointer-events: none;
      background-image:
        linear-gradient(rgba(61,142,240,0.035) 1px, transparent 1px),
        linear-gradient(90deg, rgba(61,142,240,0.035) 1px, transparent 1px);
      background-size: 48px 48px;
    }

    /* Scanline effect */
    body::after {
      content: '';
      position: fixed; inset: 0; z-index: 0; pointer-events: none;
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(0,0,0,0.03) 2px,
        rgba(0,0,0,0.03) 4px
      );
    }

    .wrap { max-width: 1100px; margin: 0 auto; padding: 0 24px; position: relative; z-index: 1; }

    /* ─── HEADER ─── */
    header {
      border-bottom: 1px solid var(--border);
      padding: 20px 0;
      position: sticky; top: 0; z-index: 50;
      background: rgba(6,10,16,0.92);
      backdrop-filter: blur(16px);
    }
    .header-inner {
      display: flex; align-items: center; justify-content: space-between;
    }
    .logo {
      font-family: var(--display);
      font-size: 20px; font-weight: 800;
      color: var(--blue);
      display: flex; align-items: center; gap: 10px;
    }
    .logo .slash { color: var(--cyan); }
    .logo-sub {
      font-family: var(--mono);
      font-size: 10px;
      color: var(--muted);
      letter-spacing: 0.12em;
      text-transform: uppercase;
      margin-top: 2px;
    }
    .header-right {
      display: flex; align-items: center; gap: 20px;
    }
    .live-badge {
      display: flex; align-items: center; gap: 7px;
      font-size: 10px; color: var(--green);
      letter-spacing: 0.1em; text-transform: uppercase;
      border: 1px solid rgba(34,197,94,0.25);
      padding: 5px 12px; border-radius: 20px;
      background: rgba(34,197,94,0.06);
    }
    .live-dot {
      width: 6px; height: 6px; background: var(--green);
      border-radius: 50%;
      box-shadow: 0 0 6px var(--green);
      animation: blink 1.5s infinite;
    }
    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }
    .back-link {
      font-size: 11px; color: var(--muted);
      text-decoration: none;
      display: flex; align-items: center; gap: 6px;
      transition: color 0.2s;
    }
    .back-link:hover { color: var(--blue); }

    /* ─── API CONFIG ─── */
    .config-bar {
      background: var(--s1);
      border-bottom: 1px solid var(--border);
      padding: 14px 0;
    }
    .config-inner {
      display: flex; align-items: center; gap: 12px; flex-wrap: wrap;
    }
    .config-label {
      font-size: 10px; color: var(--muted);
      letter-spacing: 0.1em; text-transform: uppercase;
      white-space: nowrap;
    }
    .config-label i { color: var(--blue); margin-right: 6px; }
    .config-fields {
      display: flex; gap: 8px; flex-wrap: wrap; flex: 1;
    }
    .config-field {
      display: flex; align-items: center; gap: 6px;
      background: var(--s2);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 6px 10px;
      flex: 1; min-width: 200px;
    }
    .config-field label {
      font-size: 9px; color: var(--muted); white-space: nowrap;
      letter-spacing: 0.08em; text-transform: uppercase;
    }
    .config-field input {
      background: none; border: none; outline: none;
      color: var(--cyan); font-family: var(--mono);
      font-size: 11px; width: 100%;
    }
    .config-field input::placeholder { color: var(--muted); opacity: 0.5; }
    .btn-save-cfg {
      background: rgba(61,142,240,0.12);
      border: 1px solid var(--border2);
      border-radius: 4px;
      padding: 6px 16px;
      font-family: var(--mono);
      font-size: 10px; color: var(--blue);
      cursor: pointer; letter-spacing: 0.08em;
      text-transform: uppercase;
      transition: all 0.2s; white-space: nowrap;
    }
    .btn-save-cfg:hover { background: rgba(61,142,240,0.22); }

    /* ─── HERO ─── */
    .toolkit-hero {
      padding: 60px 0 40px;
      text-align: center;
    }
    .terminal-prompt {
      font-size: 11px; color: var(--green);
      margin-bottom: 16px;
      letter-spacing: 0.08em;
    }
    .terminal-prompt span { color: var(--muted); }
    h1.toolkit-title {
      font-family: var(--display);
      font-size: clamp(2.2rem, 5vw, 3.6rem);
      font-weight: 800;
      color: var(--white);
      letter-spacing: -0.02em;
      margin-bottom: 14px;
      line-height: 1.1;
    }
    h1.toolkit-title em { color: var(--blue); font-style: normal; }
    .toolkit-sub {
      font-size: 12px; color: var(--muted);
      max-width: 560px; margin: 0 auto 40px;
      line-height: 1.8; letter-spacing: 0.02em;
    }

    /* ─── TOOL TABS ─── */
    .tool-tabs {
      display: flex; gap: 4px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 0;
      overflow-x: auto;
    }
    .tab-btn {
      background: none; border: none;
      font-family: var(--mono); font-size: 11px;
      color: var(--muted); padding: 12px 20px;
      cursor: pointer; letter-spacing: 0.06em;
      text-transform: uppercase;
      position: relative;
      transition: color 0.2s;
      white-space: nowrap;
      display: flex; align-items: center; gap: 8px;
    }
    .tab-btn i { font-size: 12px; }
    .tab-btn::after {
      content: '';
      position: absolute; bottom: -1px; left: 0; right: 0;
      height: 2px; background: var(--blue);
      transform: scaleX(0); transition: transform 0.2s;
    }
    .tab-btn:hover { color: var(--white); }
    .tab-btn.active { color: var(--blue); }
    .tab-btn.active::after { transform: scaleX(1); }

    /* ─── TOOL PANELS ─── */
    .tool-panel { display: none; padding: 40px 0; }
    .tool-panel.active { display: block; }

    /* Input row */
    .input-row {
      display: flex; gap: 10px; margin-bottom: 32px;
    }
    .main-input {
      flex: 1;
      background: var(--s1);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 14px 18px;
      font-family: var(--mono); font-size: 13px;
      color: var(--white); outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    .main-input:focus {
      border-color: var(--blue);
      box-shadow: 0 0 0 3px rgba(61,142,240,0.1);
    }
    .main-input::placeholder { color: var(--muted); }
    .btn-scan {
      background: var(--blue);
      border: 1px solid var(--blue);
      border-radius: 6px;
      padding: 14px 28px;
      font-family: var(--mono); font-size: 11px;
      font-weight: 600; color: #fff;
      cursor: pointer; letter-spacing: 0.1em;
      text-transform: uppercase;
      transition: all 0.2s;
      white-space: nowrap;
      display: flex; align-items: center; gap: 8px;
    }
    .btn-scan:hover { background: transparent; box-shadow: 0 0 20px var(--glow); }
    .btn-scan:disabled { opacity: 0.4; cursor: not-allowed; }

    /* Quick examples */
    .examples {
      display: flex; align-items: center; gap: 10px;
      margin-bottom: 32px; flex-wrap: wrap;
    }
    .examples-label { font-size: 10px; color: var(--muted); letter-spacing: 0.08em; text-transform: uppercase; }
    .example-chip {
      font-size: 10px; color: var(--blue);
      border: 1px solid var(--border);
      padding: 4px 12px; border-radius: 20px;
      cursor: pointer; transition: all 0.15s;
      background: rgba(61,142,240,0.05);
    }
    .example-chip:hover { background: rgba(61,142,240,0.15); border-color: var(--blue); }

    /* ─── LOADING ─── */
    .loading {
      display: none;
      padding: 40px;
      text-align: center;
    }
    .loading.active { display: block; }
    .scan-animation {
      display: inline-flex; flex-direction: column;
      align-items: center; gap: 16px;
    }
    .scan-ring {
      width: 60px; height: 60px;
      border: 2px solid var(--border);
      border-top-color: var(--blue);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .scan-text {
      font-size: 11px; color: var(--muted);
      letter-spacing: 0.1em; text-transform: uppercase;
    }
    .scan-log {
      margin-top: 12px;
      font-size: 10px; color: var(--green);
      height: 16px;
    }

    /* ─── RESULTS ─── */
    .results-area { }
    .result-card {
      background: var(--s1);
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 16px;
      animation: slideIn 0.35s ease;
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(12px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .result-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      background: var(--s2);
    }
    .result-source {
      font-size: 10px; color: var(--muted);
      letter-spacing: 0.1em; text-transform: uppercase;
      display: flex; align-items: center; gap: 8px;
    }
    .result-source i { color: var(--blue); }
    .verdict {
      font-size: 11px; font-weight: 600;
      padding: 4px 12px; border-radius: 20px;
      letter-spacing: 0.08em; text-transform: uppercase;
    }
    .verdict-clean   { background: rgba(34,197,94,0.12);  color: var(--green);  border: 1px solid rgba(34,197,94,0.3); }
    .verdict-malicious{ background: rgba(239,68,68,0.12); color: var(--red);    border: 1px solid rgba(239,68,68,0.3); }
    .verdict-suspicious{background: rgba(234,179,8,0.12); color: var(--yellow); border: 1px solid rgba(234,179,8,0.3); }
    .verdict-unknown  { background: rgba(90,112,144,0.12);color: var(--muted2); border: 1px solid var(--border); }
    .verdict-noise    { background: rgba(249,115,22,0.12); color: var(--orange); border: 1px solid rgba(249,115,22,0.3); }

    .result-body { padding: 20px; }
    .data-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 12px;
    }
    .data-cell {
      background: var(--s2);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 12px 14px;
    }
    .data-label {
      font-size: 9px; color: var(--muted);
      letter-spacing: 0.1em; text-transform: uppercase;
      margin-bottom: 6px;
    }
    .data-value {
      font-size: 13px; color: var(--white);
      word-break: break-all;
    }
    .data-value.highlight { color: var(--cyan); }
    .data-value.danger    { color: var(--red); }
    .data-value.safe      { color: var(--green); }
    .data-value.warn      { color: var(--yellow); }

    /* Engine results grid for VT */
    .engine-summary {
      display: flex; gap: 12px; margin-top: 16px; flex-wrap: wrap;
    }
    .engine-box {
      flex: 1; min-width: 100px;
      background: var(--s2);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 16px;
      text-align: center;
    }
    .engine-count {
      font-family: var(--display);
      font-size: 2rem; font-weight: 800;
      margin-bottom: 4px;
    }
    .engine-count.red    { color: var(--red); }
    .engine-count.green  { color: var(--green); }
    .engine-count.yellow { color: var(--yellow); }
    .engine-count.gray   { color: var(--muted2); }
    .engine-label { font-size: 9px; color: var(--muted); letter-spacing: 0.08em; text-transform: uppercase; }

    /* CVE Cards */
    .cve-list { display: flex; flex-direction: column; gap: 10px; }
    .cve-item {
      background: var(--s1);
      border: 1px solid var(--border);
      border-left: 3px solid var(--border);
      border-radius: 4px;
      padding: 14px 18px;
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 16px; align-items: center;
      transition: border-color 0.2s;
      animation: slideIn 0.3s ease;
    }
    .cve-item:hover { border-color: var(--blue); }
    .cve-item.critical { border-left-color: var(--red); }
    .cve-item.high     { border-left-color: var(--orange); }
    .cve-item.medium   { border-left-color: var(--yellow); }
    .cve-item.low      { border-left-color: var(--green); }
    .cve-id { font-size: 11px; font-weight: 600; color: var(--blue); white-space: nowrap; }
    .cve-desc { font-size: 11px; color: var(--muted2); line-height: 1.6; }
    .cvss-badge {
      font-size: 11px; font-weight: 600;
      padding: 4px 10px; border-radius: 4px;
      white-space: nowrap;
    }
    .cvss-critical { background: rgba(239,68,68,0.15);  color: var(--red);    border: 1px solid rgba(239,68,68,0.3); }
    .cvss-high     { background: rgba(249,115,22,0.15); color: var(--orange); border: 1px solid rgba(249,115,22,0.3); }
    .cvss-medium   { background: rgba(234,179,8,0.15);  color: var(--yellow); border: 1px solid rgba(234,179,8,0.3); }
    .cvss-low      { background: rgba(34,197,94,0.15);  color: var(--green);  border: 1px solid rgba(34,197,94,0.3); }
    .cvss-none     { background: rgba(90,112,144,0.1);  color: var(--muted2); border: 1px solid var(--border); }

    /* Cert list */
    .cert-entries { display: flex; flex-direction: column; gap: 6px; max-height: 500px; overflow-y: auto; }
    .cert-entry {
      background: var(--s2);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 10px 14px;
      display: grid;
      grid-template-columns: 1fr auto auto;
      gap: 12px; align-items: center;
      font-size: 11px;
      animation: slideIn 0.2s ease;
    }
    .cert-entry:hover { border-color: var(--blue); }
    .cert-name { color: var(--white); word-break: break-all; }
    .cert-issuer-badge {
      font-size: 9px; padding: 2px 8px;
      border-radius: 20px;
      background: rgba(61,142,240,0.08);
      border: 1px solid var(--border);
      color: var(--muted); white-space: nowrap;
    }
    .cert-date { color: var(--muted); font-size: 10px; white-space: nowrap; }

    /* Error state */
    .error-card {
      background: rgba(239,68,68,0.05);
      border: 1px solid rgba(239,68,68,0.2);
      border-radius: 6px;
      padding: 20px 24px;
      display: flex; align-items: flex-start; gap: 14px;
    }
    .error-card i { color: var(--red); font-size: 18px; margin-top: 2px; }
    .error-title { color: var(--red); font-weight: 600; margin-bottom: 4px; }
    .error-msg { color: var(--muted2); font-size: 12px; line-height: 1.6; }

    /* Info box */
    .info-box {
      background: rgba(61,142,240,0.05);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 16px 20px;
      font-size: 11px; color: var(--muted2);
      line-height: 1.7;
      margin-bottom: 24px;
    }
    .info-box i { color: var(--blue); margin-right: 8px; }

    /* URL scan result extras */
    .url-screenshot {
      width: 100%; max-width: 600px;
      border: 1px solid var(--border);
      border-radius: 4px;
      margin-top: 16px;
    }
    .progress-bar-wrap {
      background: var(--s3);
      border-radius: 4px; height: 6px;
      overflow: hidden; margin-top: 4px;
    }
    .progress-bar { height: 100%; border-radius: 4px; transition: width 0.6s; }

    /* Footer */
    footer {
      border-top: 1px solid var(--border);
      padding: 28px 0;
      text-align: center;
      color: var(--muted);
      font-size: 10px;
      letter-spacing: 0.08em;
      position: relative; z-index: 1;
    }
    footer a { color: var(--blue); text-decoration: none; }
    footer .disclaimer {
      max-width: 600px; margin: 8px auto 0;
      font-size: 10px; color: var(--muted); opacity: 0.7;
      line-height: 1.7;
    }

    @media(max-width: 700px) {
      .input-row { flex-direction: column; }
      .data-grid { grid-template-columns: 1fr 1fr; }
      .cve-item { grid-template-columns: 1fr; }
      .cert-entry { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="wrap header-inner">
    <div>
      <div class="logo">NK<span class="slash">//</span>OSINT</div>
      <div class="logo-sub">Threat Intelligence Toolkit · by Nehal Kalbande</div>
    </div>
    <div class="header-right">
      <div class="live-badge"><div class="live-dot"></div>Live APIs</div>
      <a href="index.html" class="back-link"><i class="fas fa-arrow-left"></i> Portfolio</a>
    </div>
  </div>
</header>

<!-- SERVER STATUS BAR -->
<div class="config-bar">
  <div class="wrap config-inner">
    <div class="config-label"><i class="fas fa-server"></i>Server Status</div>
    <div class="config-fields" style="align-items:center;gap:20px;">
      <div style="display:flex;gap:16px;align-items:center;flex-wrap:wrap;">
        <span id="vt-status"      style="font-size:11px;color:var(--muted);">&#9203; VirusTotal</span>
        <span style="color:var(--border)">|</span>
        <span id="urlscan-status" style="font-size:11px;color:var(--muted);">&#9203; URLScan</span>
        <span style="color:var(--border)">|</span>
        <span style="font-size:11px;color:var(--green);">&#10003; CVE Feed</span>
        <span style="color:var(--border)">|</span>
        <span style="font-size:11px;color:var(--green);">&#10003; Cert Intel</span>
      </div>
      <span style="font-size:10px;color:var(--muted);">API keys secured server-side &#8212; never exposed to browser</span>
    </div>
    <span id="server-ping" style="font-size:10px;color:var(--muted);white-space:nowrap;">Connecting...</span>
  </div>
</div>

<!-- HERO -->
<div class="wrap">
  <div class="toolkit-hero">
    <div class="terminal-prompt">nehal@soc:~$ <span>./threat-toolkit --interactive</span><span style="animation:blink 1s infinite;display:inline">▌</span></div>
    <h1 class="toolkit-title">Live Threat <em>Intelligence</em><br/>Toolkit</h1>
    <p class="toolkit-sub">
      Real-time IOC enrichment, URL scanning, certificate intelligence, and CVE monitoring — 
      the exact workflow I run every day as a SOC Analyst, now in your browser.
    </p>
  </div>

  <!-- TABS -->
  <div class="tool-tabs">
    <button class="tab-btn active" onclick="switchTab('ioc',this)">
      <i class="fas fa-crosshairs"></i>IOC Lookup
    </button>
    <button class="tab-btn" onclick="switchTab('url',this)">
      <i class="fas fa-link"></i>URL Scanner
    </button>
    <button class="tab-btn" onclick="switchTab('cert',this)">
      <i class="fas fa-certificate"></i>Cert Intel
    </button>
    <button class="tab-btn" onclick="switchTab('cve',this)">
      <i class="fas fa-bug"></i>Live CVE Feed
    </button>
  </div>

  <!-- ══ IOC LOOKUP ══ -->
  <div class="tool-panel active" id="panel-ioc">
    <div class="info-box">
      <i class="fas fa-info-circle"></i>
      Enter an <strong>IP address</strong>, <strong>domain</strong>, <strong>URL</strong>, or <strong>file hash (MD5/SHA256)</strong>.
      Queries VirusTotal for multi-engine reputation analysis + GreyNoise for noise classification.
      API keys are configured on the server — no browser setup needed.
    </div>
    <div class="input-row">
      <input class="main-input" id="ioc-input" placeholder="e.g. 8.8.8.8  or  evil.com  or  d41d8cd98f00b204e9800998ecf8427e" />
      <button class="btn-scan" id="ioc-btn" onclick="runIOC()">
        <i class="fas fa-search"></i>Analyse
      </button>
    </div>
    <div class="examples">
      <span class="examples-label">Try:</span>
      <span class="example-chip" onclick="fillAndRun('ioc-input','8.8.8.8',runIOC)">8.8.8.8</span>
      <span class="example-chip" onclick="fillAndRun('ioc-input','google.com',runIOC)">google.com</span>
      <span class="example-chip" onclick="fillAndRun('ioc-input','44d88612fea8a8f36de82e1278abb02f',runIOC)">EICAR hash</span>
    </div>
    <div class="loading" id="ioc-loading">
      <div class="scan-animation">
        <div class="scan-ring"></div>
        <div class="scan-text">Querying threat intelligence sources</div>
        <div class="scan-log" id="ioc-log"></div>
      </div>
    </div>
    <div class="results-area" id="ioc-results"></div>
  </div>

  <!-- ══ URL SCANNER ══ -->
  <div class="tool-panel" id="panel-url">
    <div class="info-box">
      <i class="fas fa-info-circle"></i>
      Submit a URL for sandboxed scanning via <strong>URLScan.io</strong>. Returns threat score, DNS records, HTTP behaviour, 
      redirect chains, and a screenshot. API key is configured on the server. Results take ~15 seconds to process.
    </div>
    <div class="input-row">
      <input class="main-input" id="url-input" placeholder="e.g. https://suspicious-site.com/login"/>
      <button class="btn-scan" id="url-btn" onclick="runURLScan()">
        <i class="fas fa-satellite-dish"></i>Scan URL
      </button>
    </div>
    <div class="examples">
      <span class="examples-label">Examples:</span>
      <span class="example-chip" onclick="document.getElementById('url-input').value='https://example.com'">example.com</span>
      <span class="example-chip" onclick="document.getElementById('url-input').value='https://github.com'">github.com</span>
    </div>
    <div class="loading" id="url-loading">
      <div class="scan-animation">
        <div class="scan-ring"></div>
        <div class="scan-text">Scanning URL in isolated sandbox</div>
        <div class="scan-log" id="url-log"></div>
      </div>
    </div>
    <div class="results-area" id="url-results"></div>
  </div>

  <!-- ══ CERT INTEL ══ -->
  <div class="tool-panel" id="panel-cert">
    <div class="info-box">
      <i class="fas fa-info-circle"></i>
      Query <strong>crt.sh</strong> certificate transparency logs to enumerate subdomains and discover 
      exposed infrastructure. No API key required — completely free via public CT logs.
    </div>
    <div class="input-row">
      <input class="main-input" id="cert-input" placeholder="e.g. barclays.com"/>
      <button class="btn-scan" id="cert-btn" onclick="runCertIntel()">
        <i class="fas fa-sitemap"></i>Enumerate
      </button>
    </div>
    <div class="examples">
      <span class="examples-label">Try:</span>
      <span class="example-chip" onclick="fillAndRun('cert-input','github.com',runCertIntel)">github.com</span>
      <span class="example-chip" onclick="fillAndRun('cert-input','microsoft.com',runCertIntel)">microsoft.com</span>
    </div>
    <div class="loading" id="cert-loading">
      <div class="scan-animation">
        <div class="scan-ring"></div>
        <div class="scan-text">Querying certificate transparency logs</div>
      </div>
    </div>
    <div class="results-area" id="cert-results"></div>
  </div>

  <!-- ══ CVE FEED ══ -->
  <div class="tool-panel" id="panel-cve">
    <div class="info-box">
      <i class="fas fa-info-circle"></i>
      Live feed of the <strong>latest published CVEs</strong> from CIRCL CVE API — no key required.
      Includes CVSS scores, severity ratings, and descriptions. Auto-refreshes on load.
    </div>
    <div class="input-row">
      <input class="main-input" id="cve-input" placeholder="Search CVE ID or keyword (e.g. apache, CVE-2024-1234) — leave blank for latest"/>
      <button class="btn-scan" id="cve-btn" onclick="runCVEFeed()">
        <i class="fas fa-rss"></i>Fetch Feed
      </button>
    </div>
    <div class="loading" id="cve-loading">
      <div class="scan-animation">
        <div class="scan-ring"></div>
        <div class="scan-text">Fetching latest vulnerability disclosures</div>
      </div>
    </div>
    <div class="results-area" id="cve-results"></div>
  </div>

</div><!-- /wrap -->

<footer>
  <div class="wrap">
    <p>Built by <a href="index.html">Nehal Kalbande</a> · SOC Analyst · Nagpur, India · <a href="/cdn-cgi/l/email-protection#aec0cbc6cfc2c5cfc2cccfc0cacb9a9aeec9c3cfc7c280cdc1c3"><span class="__cf_email__" data-cfemail="2c4249444d40474d404e4d42484918186c4b414d4540024f4341">[email&#160;protected]</span></a></p>
    <p class="disclaimer">
      ⚠️ Educational &amp; professional use only. All lookups are passive. No active scanning or exploitation is performed.
      API keys are stored securely on the server and never exposed to the browser.
    </p>
  </div>
</footer>
<script>
// All API calls proxied through Express server — keys never in browser
const API_BASE = '/api/toolkit';

// Server health check
async function checkServerHealth() {
  try {
    const res = await fetch('/api/health');
    const d = await res.json();
    const vt = document.getElementById('vt-status');
    const us = document.getElementById('urlscan-status');
    const pg = document.getElementById('server-ping');
    if (vt) { vt.textContent = d.keys && d.keys.virustotal ? '&#10003; VirusTotal' : '&#10007; VirusTotal'; vt.style.color = d.keys && d.keys.virustotal ? 'var(--green)' : 'var(--red)'; }
    if (us) { us.textContent = d.keys && d.keys.urlscan    ? '&#10003; URLScan'    : '&#10007; URLScan';    us.style.color = d.keys && d.keys.urlscan    ? 'var(--green)' : 'var(--red)'; }
    if (pg) { pg.textContent = 'Server online'; pg.style.color = 'var(--green)'; }
  } catch(_) {
    const pg = document.getElementById('server-ping');
    if (pg) { pg.textContent = 'Server offline'; pg.style.color = 'var(--red)'; }
  }
}

function switchTab(id, btn) {
  document.querySelectorAll('.tool-panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('panel-' + id).classList.add('active');
  btn.classList.add('active');
  if (id === 'cve') runCVEFeed();
}
function fillAndRun(inputId, value, fn) { document.getElementById(inputId).value = value; fn(); }
function setLoading(id, on) {
  document.getElementById(id + '-loading').classList.toggle('active', on);
  var btn = document.getElementById(id + '-btn');
  if (btn) btn.disabled = on;
}
function clearResults(id)      { document.getElementById(id + '-results').innerHTML = ''; }
function appendResult(id, html){ document.getElementById(id + '-results').insertAdjacentHTML('beforeend', html); }
function showError(id, title, msg) {
  appendResult(id, '<div class="error-card"><i class="fas fa-triangle-exclamation"></i><div><div class="error-title">' + title + '</div><div class="error-msg">' + msg + '</div></div></div>');
}
function setLog(logId, msg) { var el = document.getElementById(logId); if (el) el.textContent = msg ? '> ' + msg : ''; }
function detectIOCType(val) {
  val = val.trim();
  if (/^(\d{1,3}\.){3}\d{1,3}$/.test(val)) return 'ip';
  if (/^[a-fA-F0-9]{32}$/.test(val) || /^[a-fA-F0-9]{64}$/.test(val)) return 'hash';
  if (/^https?:\/\//i.test(val)) return 'url';
  return 'domain';
}
function cvssClass(s) {
  if (!s && s !== 0) return 'none';
  if (s >= 9) return 'critical'; if (s >= 7) return 'high'; if (s >= 4) return 'medium'; return 'low';
}
function esc(str) { return String(str||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function sleep(ms) { return new Promise(function(r){ setTimeout(r, ms); }); }

// ── IOC LOOKUP ────────────────────────────────────────────────────
async function runIOC() {
  var raw = document.getElementById('ioc-input').value.trim();
  if (!raw) return;
  clearResults('ioc'); setLoading('ioc', true);
  var type = detectIOCType(raw);
  setLog('ioc-log', 'Querying VirusTotal [' + type.toUpperCase() + ']...');
  try {
    var res;
    if      (type === 'url')  res = await fetch(API_BASE + '/vt/url',    { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({url:raw}) });
    else if (type === 'hash') res = await fetch(API_BASE + '/vt/hash/'   + raw);
    else if (type === 'ip')   res = await fetch(API_BASE + '/vt/ip/'     + encodeURIComponent(raw));
    else                      res = await fetch(API_BASE + '/vt/domain/' + encodeURIComponent(raw));
    var data = await res.json();
    if (!res.ok) throw new Error(data.error || data.message || 'Server error ' + res.status);
    var attr  = (data.data && data.data.attributes) || {};
    var stats = attr.last_analysis_stats || {};
    var mal  = stats.malicious  || 0;
    var sus  = stats.suspicious || 0;
    var cln  = stats.undetected || stats.harmless || 0;
    var tot  = Object.values(stats).reduce(function(a,b){return a+b;},0);
    var vC = mal>0 ? 'verdict-malicious' : sus>0 ? 'verdict-suspicious' : 'verdict-clean';
    var vT = mal>0 ? '&#9888; Malicious ('+mal+'/'+tot+')' : sus>0 ? '? Suspicious ('+sus+'/'+tot+')' : '&#10003; Clean';
    var extra = '';
    if (type==='ip') extra = '<div class="data-cell"><div class="data-label">Country</div><div class="data-value highlight">'+esc(attr.country||'N/A')+'</div></div><div class="data-cell"><div class="data-label">ASN</div><div class="data-value">'+esc(attr.asn||'N/A')+'</div></div><div class="data-cell"><div class="data-label">AS Owner</div><div class="data-value">'+esc(attr.as_owner||'N/A')+'</div></div><div class="data-cell"><div class="data-label">Network</div><div class="data-value">'+esc(attr.network||'N/A')+'</div></div>';
    else if (type==='domain') extra = '<div class="data-cell"><div class="data-label">Registrar</div><div class="data-value">'+esc(attr.registrar||'N/A')+'</div></div><div class="data-cell"><div class="data-label">Creation Date</div><div class="data-value">'+(attr.creation_date ? new Date(attr.creation_date*1000).toLocaleDateString() : 'N/A')+'</div></div><div class="data-cell"><div class="data-label">Reputation Score</div><div class="data-value '+((attr.reputation||0)<0?'danger':'safe')+'">'+((attr.reputation !== undefined && attr.reputation !== null) ? attr.reputation : 'N/A')+'</div></div>';
    else if (type==='hash') extra = '<div class="data-cell"><div class="data-label">File Name</div><div class="data-value">'+esc(attr.names&&attr.names[0]||'N/A')+'</div></div><div class="data-cell"><div class="data-label">File Type</div><div class="data-value">'+esc(attr.type_description||attr.magic||'N/A')+'</div></div><div class="data-cell"><div class="data-label">File Size</div><div class="data-value">'+(attr.size?(attr.size/1024).toFixed(1)+' KB':'N/A')+'</div></div><div class="data-cell"><div class="data-label">First Seen</div><div class="data-value">'+(attr.first_submission_date?new Date(attr.first_submission_date*1000).toLocaleDateString():'N/A')+'</div></div>';
    appendResult('ioc',
      '<div class="result-card"><div class="result-header"><div class="result-source"><i class="fas fa-shield-virus"></i>VirusTotal &middot; '+type.toUpperCase()+' Analysis</div><span class="verdict '+vC+'">'+vT+'</span></div><div class="result-body">' +
      '<div class="engine-summary"><div class="engine-box"><div class="engine-count red">'+mal+'</div><div class="engine-label">Malicious</div></div><div class="engine-box"><div class="engine-count yellow">'+sus+'</div><div class="engine-label">Suspicious</div></div><div class="engine-box"><div class="engine-count green">'+cln+'</div><div class="engine-label">Clean</div></div><div class="engine-box"><div class="engine-count gray">'+tot+'</div><div class="engine-label">Total Engines</div></div></div>' +
      '<div class="data-grid" style="margin-top:16px"><div class="data-cell"><div class="data-label">IOC</div><div class="data-value highlight">'+esc(raw)+'</div></div><div class="data-cell"><div class="data-label">Type</div><div class="data-value">'+type.toUpperCase()+'</div></div><div class="data-cell"><div class="data-label">Last Scanned</div><div class="data-value">'+(attr.last_analysis_date?new Date(attr.last_analysis_date*1000).toLocaleString():'N/A')+'</div></div>'+extra+'</div>' +
      (mal>0?'<div style="margin-top:16px;padding:12px 16px;background:rgba(239,68,68,0.06);border:1px solid rgba(239,68,68,0.2);border-radius:6px;font-size:11px;color:#f87171;"><strong>&#9888; ANALYST NOTE:</strong> Flagged by '+mal+' engines. Recommend immediate containment and escalation per SOC runbook.</div>':'') +
      '</div></div>'
    );
    if (type==='ip') {
      setLog('ioc-log','Querying GreyNoise...');
      try {
        var gn = await (await fetch(API_BASE+'/greynoise/'+raw)).json();
        var gnVC = gn.riot?'verdict-clean':gn.noise?'verdict-noise':'verdict-unknown';
        var gnT  = gn.riot?'&#10003; Common Service (RIOT)':gn.noise?'~ Internet Noise':'? Unknown';
        appendResult('ioc',
          '<div class="result-card"><div class="result-header"><div class="result-source"><i class="fas fa-globe"></i>GreyNoise &middot; Noise Classification</div><span class="verdict '+gnVC+'">'+gnT+'</span></div><div class="result-body">' +
          '<div class="data-grid"><div class="data-cell"><div class="data-label">Classification</div><div class="data-value">'+esc(gn.classification||'Unknown')+'</div></div><div class="data-cell"><div class="data-label">Name</div><div class="data-value">'+esc(gn.name||'Unknown')+'</div></div><div class="data-cell"><div class="data-label">Mass-Scanner</div><div class="data-value '+(gn.noise?'warn':'safe')+'">'+(gn.noise?'YES':'No')+'</div></div><div class="data-cell"><div class="data-label">Trusted Service</div><div class="data-value '+(gn.riot?'safe':'warn')+'">'+(gn.riot?'YES':'No')+'</div></div></div>' +
          (gn.noise&&!gn.riot?'<div style="margin-top:12px;font-size:11px;color:var(--muted2);padding:10px 14px;background:var(--s2);border-radius:4px;border:1px solid var(--border);">&#128161; <strong>Analyst context:</strong> This IP is a mass-scanner. Alerts from it may be background internet noise &mdash; consider SIEM threshold tuning.</div>':'') +
          '</div></div>'
        );
      } catch(_) {}
    }
  } catch(err) {
    showError('ioc','Lookup Failed', err.message + ' &mdash; Ensure server is running and VT_API_KEY is set in .env');
  } finally { setLoading('ioc',false); setLog('ioc-log',''); }
}

// ── URL SCANNER ───────────────────────────────────────────────────
async function runURLScan() {
  var url = document.getElementById('url-input').value.trim();
  if (!url) return;
  clearResults('url'); setLoading('url',true);
  try {
    setLog('url-log','Submitting URL to sandbox...');
    var sr = await fetch(API_BASE+'/urlscan/submit',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({url:url})});
    var sd = await sr.json();
    if (!sr.ok) throw new Error(sd.error||sd.message||'HTTP '+sr.status);
    var uuid=sd.uuid; var scanUrl=sd.result;
    appendResult('url',
      '<div class="result-card"><div class="result-header"><div class="result-source"><i class="fas fa-satellite-dish"></i>URLScan.io &middot; Submission Accepted</div><span class="verdict verdict-unknown">Processing</span></div><div class="result-body">' +
      '<div class="data-grid"><div class="data-cell"><div class="data-label">Scan UUID</div><div class="data-value highlight">'+esc(uuid)+'</div></div><div class="data-cell"><div class="data-label">Target URL</div><div class="data-value">'+esc(url)+'</div></div><div class="data-cell"><div class="data-label">Visibility</div><div class="data-value">Unlisted</div></div><div class="data-cell"><div class="data-label">Status</div><div class="data-value" id="scan-status">Waiting (~15s)...</div></div></div></div></div>'
    );
    var a=0;
    while(a<12){
      await sleep(5000); a++;
      setLog('url-log','Polling... attempt '+a+'/12');
      try {
        var rr=await fetch(API_BASE+'/urlscan/result/'+uuid);
        if(rr.status===404) continue;
        var rd=await rr.json();
        if(!rr.ok) continue;
        var el=document.getElementById('scan-status'); if(el) el.textContent='Complete';
        var score=((rd.verdicts||{}).overall||{}).score||0;
        var mal2=((rd.verdicts||{}).overall||{}).malicious||false;
        var brands=((((rd.verdicts||{}).overall||{}).brands)||[]).join(', ')||'None detected';
        var cats=((((rd.verdicts||{}).overall||{}).categories)||[]).join(', ')||'Uncategorised';
        var pg2=rd.page||{}; var st=rd.stats||{};
        var sVC=mal2?'verdict-malicious':score>50?'verdict-suspicious':'verdict-clean';
        var sT=mal2?'&#9888; Malicious ('+score+'/100)':score>50?'? Suspicious ('+score+'/100)':'&#10003; Clean ('+score+'/100)';
        var sCol=score>70?'var(--red)':score>40?'var(--yellow)':'var(--green)';
        appendResult('url',
          '<div class="result-card"><div class="result-header"><div class="result-source"><i class="fas fa-magnifying-glass"></i>URLScan.io &middot; Scan Results</div><span class="verdict '+sVC+'">'+sT+'</span></div><div class="result-body">' +
          '<div style="margin-bottom:16px;"><div style="display:flex;justify-content:space-between;margin-bottom:6px;"><span style="font-size:10px;color:var(--muted);letter-spacing:.08em;text-transform:uppercase;">Threat Score</span><span style="font-size:11px;color:'+sCol+'">'+score+'/100</span></div><div class="progress-bar-wrap"><div class="progress-bar" style="width:'+score+'%;background:'+sCol+'"></div></div></div>' +
          '<div class="data-grid"><div class="data-cell"><div class="data-label">Final URL</div><div class="data-value highlight">'+esc(pg2.url||url)+'</div></div><div class="data-cell"><div class="data-label">IP</div><div class="data-value">'+esc(pg2.ip||'N/A')+'</div></div><div class="data-cell"><div class="data-label">Server</div><div class="data-value">'+esc(pg2.server||'N/A')+'</div></div><div class="data-cell"><div class="data-label">Country</div><div class="data-value">'+esc(pg2.country||'N/A')+'</div></div><div class="data-cell"><div class="data-label">Requests</div><div class="data-value">'+(st.requests||0)+'</div></div><div class="data-cell"><div class="data-label">Domains</div><div class="data-value">'+((st.domainStats||[]).length||0)+'</div></div><div class="data-cell"><div class="data-label">Brand Impersonation</div><div class="data-value '+(brands!=='None detected'?'danger':'')+'">'+esc(brands)+'</div></div><div class="data-cell"><div class="data-label">Categories</div><div class="data-value">'+esc(cats)+'</div></div></div>' +
          (rd.screenshot?'<img class="url-screenshot" src="'+esc(rd.screenshot)+'" alt="Page screenshot" loading="lazy"/>':'') +
          '<div style="margin-top:14px;font-size:10px;color:var(--muted);">Full report: <a href="'+esc(scanUrl||'#')+'" target="_blank" rel="noopener" style="color:var(--blue)">'+esc(scanUrl||uuid)+'</a></div></div></div>'
        );
        break;
      } catch(_){}
    }
  } catch(err){ showError('url','Scan Failed',err.message+' &mdash; Ensure URLSCAN_API_KEY is in .env'); }
  finally { setLoading('url',false); setLog('url-log',''); }
}

// ── CERT INTEL ────────────────────────────────────────────────────
async function runCertIntel() {
  var domain = document.getElementById('cert-input').value.trim().replace(/^https?:\/\//i,'').split('/')[0];
  if (!domain) return;
  clearResults('cert'); setLoading('cert',true);
  try {
    var res = await fetch(API_BASE+'/crt/'+encodeURIComponent(domain));
    if (!res.ok) throw new Error('HTTP '+res.status);
    var data = await res.json();
    var seen=new Set();
    var unique=data.filter(function(c){var k=c.common_name;if(seen.has(k))return false;seen.add(k);return true;}).slice(0,80);
    var wc=unique.filter(function(c){return c.common_name.startsWith('*');}).length;
    var sb=unique.filter(function(c){return !c.common_name.startsWith('*');}).length;
    appendResult('cert',
      '<div class="result-card"><div class="result-header"><div class="result-source"><i class="fas fa-certificate"></i>crt.sh &middot; Certificate Transparency Logs</div><span class="verdict verdict-unknown">'+unique.length+' Entries</span></div><div class="result-body">' +
      '<div class="data-grid" style="margin-bottom:16px"><div class="data-cell"><div class="data-label">Domain Queried</div><div class="data-value highlight">'+esc(domain)+'</div></div><div class="data-cell"><div class="data-label">Total Results</div><div class="data-value">'+data.length+'</div></div><div class="data-cell"><div class="data-label">Unique Subdomains</div><div class="data-value">'+sb+'</div></div><div class="data-cell"><div class="data-label">Wildcard Certs</div><div class="data-value '+(wc>0?'warn':'')+'">'+wc+'</div></div></div>' +
      '<div style="font-size:10px;color:var(--muted);margin-bottom:10px;letter-spacing:.06em;text-transform:uppercase;">Showing '+unique.length+' of '+data.length+' entries</div>' +
      '<div class="cert-entries">'+unique.map(function(c){return '<div class="cert-entry"><div class="cert-name">'+esc(c.common_name)+'</div><div class="cert-issuer-badge">'+esc(((c.issuer_name||'').match(/O=([^,]+)/)||['','Unknown'])[1])+'</div><div class="cert-date">'+(c.not_before?c.not_before.split('T')[0]:'N/A')+'</div></div>';}).join('')+'</div>' +
      '<div style="margin-top:14px;padding:10px 14px;background:var(--s2);border-radius:4px;border:1px solid var(--border);font-size:11px;color:var(--muted2);">&#128161; <strong>Analyst note:</strong> Wildcard certs and subdomains indicate attack surface. Check for staging/dev/internal subdomains exposed publicly.</div>' +
      '</div></div>'
    );
  } catch(err){ showError('cert','Lookup Failed',err.message+'. crt.sh may be rate-limiting &mdash; try again.'); }
  finally { setLoading('cert',false); }
}

// ── CVE FEED ──────────────────────────────────────────────────────
async function runCVEFeed() {
  var q = (document.getElementById('cve-input') && document.getElementById('cve-input').value || '').trim();
  clearResults('cve'); setLoading('cve',true);
  try {
    var data;
    if (q.match(/^CVE-/i)) {
      var r=await fetch(API_BASE+'/cve/'+q.toUpperCase());
      if (!r.ok) throw new Error('CVE not found: '+q);
      data=[await r.json()];
    } else {
      var r2=await fetch(API_BASE+'/cve/latest');
      if (!r2.ok) throw new Error('HTTP '+r2.status);
      data=await r2.json();
      if (q) data=data.filter(function(c){return (c.id||'').toLowerCase().indexOf(q.toLowerCase())>=0||(c.summary||'').toLowerCase().indexOf(q.toLowerCase())>=0;});
    }
    if (!data||data.length===0){appendResult('cve','<div class="info-box"><i class="fas fa-search"></i>No CVEs found matching <strong>'+esc(q)+'</strong>.</div>');return;}
    var tc=data.filter(function(c){return (c.cvss||0)>=9;}).length;
    var th=data.filter(function(c){return (c.cvss||0)>=7&&(c.cvss||0)<9;}).length;
    appendResult('cve',
      '<div class="result-card" style="margin-bottom:16px"><div class="result-header"><div class="result-source"><i class="fas fa-rss"></i>CIRCL CVE &middot; '+(q?'Search: &quot;'+esc(q)+'&quot;':'Latest Disclosures')+'</div><span class="verdict '+(tc>0?'verdict-malicious':th>0?'verdict-suspicious':'verdict-unknown')+'">'+data.length+' CVEs</span></div><div class="result-body">' +
      '<div class="engine-summary"><div class="engine-box"><div class="engine-count red">'+tc+'</div><div class="engine-label">Critical</div></div><div class="engine-box"><div class="engine-count" style="color:var(--orange)">'+th+'</div><div class="engine-label">High</div></div><div class="engine-box"><div class="engine-count yellow">'+data.filter(function(c){return (c.cvss||0)>=4&&(c.cvss||0)<7;}).length+'</div><div class="engine-label">Medium</div></div><div class="engine-box"><div class="engine-count green">'+data.filter(function(c){return (c.cvss||0)<4;}).length+'</div><div class="engine-label">Low</div></div></div></div></div>'
    );
    appendResult('cve','<div class="cve-list" id="cve-list"></div>');
    var list=document.getElementById('cve-list');
    data.forEach(function(cve){
      var score=cve.cvss||cve.cvss3||null; var sc=cvssClass(score);
      var desc=(cve.summary||cve.description||'No description.').slice(0,180)+'...';
      var d=document.createElement('div'); d.className='cve-item '+sc;
      d.innerHTML='<div class="cve-id">'+esc(cve.id)+'</div><div class="cve-desc">'+esc(desc)+'</div><div class="cvss-badge cvss-'+sc+'">'+(score!==null?score:'N/A')+'</div>';
      list.appendChild(d);
    });
  } catch(err){ showError('cve','Feed Error',err.message); }
  finally { setLoading('cve',false); }
}

document.addEventListener('DOMContentLoaded', function() {
  checkServerHealth();
  document.addEventListener('keydown', function(e) {
    if (e.key !== 'Enter') return;
    var active = document.querySelector('.tool-panel.active');
    if (!active) return;
    var id = active.id.replace('panel-','');
    if (id==='ioc') runIOC();
    else if (id==='url') runURLScan();
    else if (id==='cert') runCertIntel();
    else if (id==='cve') runCVEFeed();
  });
});
</script>
</body>
</html>